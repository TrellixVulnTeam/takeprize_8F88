{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/\\u7530\\u5929/Desktop/takeprize/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/\\u7530\\u5929/Desktop/takeprize/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/\\u7530\\u5929/Desktop/takeprize/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import axios from'axios';import'./index.css';import{nanoid}from'nanoid';import PubSub from'pubsub-js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function WheelList(){//初始化为一个空数组很重要,没用的话被报undefined错误\nvar _useState=useState([]),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setdata=_useState2[1];// {prize_index:0,msg:''}\nvar _useState3=useState(),_useState4=_slicedToArray(_useState3,2),prize=_useState4[0],setprize=_useState4[1];var _useState5=useState({angle:0,transition:'none'}),_useState6=_slicedToArray(_useState5,2),rotate_animate=_useState6[0],setrotate=_useState6[1];// 旧写法\n// useEffect(() => {\n//     axios.post('https://qc1hz1.fn.thelarkcloud.com/prizeinfo')\n//     .then(function (res) {\n//         let prize_info = res.data.response;\n//         const n=prize_info.length;\n//         if(n<6){\n//             for(let i=n;i<6;i++){\n//                 prize_info.push({prize_name: \"谢谢参与\", isprize: false,prize_id:nanoid()});\n//             }   \n//         }\n//         if(n>6){\n//             while(prize_info.length>6){\n//                 prize_info.pop();\n//             }\n//         }\n//         setdata(prize_info);\n//     });\n// }, [])\n// 熟悉新写法!\nuseEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result,prize_info,n,i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios('https://qc1hz1.fn.thelarkcloud.com/prizeinfo');case 2:result=_context.sent;prize_info=result.data.response;n=prize_info.length;if(n<6){for(i=n;i<6;i++){prize_info.push({prize_name:\"谢谢参与\",isprize:false,prize_id:nanoid()});}}if(n>6){while(prize_info.length>6){prize_info.pop();}}setdata(prize_info);case 8:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();},[]);useEffect(function(){var token=PubSub.subscribe('Prize',function(msg,item){setprize(item);var angle=-item.prize_index*60+3600;setrotate({angle:angle,transition:'all 5s ease-out'});setTimeout(function(){//对角度进行处理，以便下次旋转\nsetrotate({angle:angle%360,transition:'none'});//通知闪烁,同时把中奖消息发送过去\nPubSub.publish('Twinkle',item.msg);},5000);});return function(){PubSub.unsubscribe(token);};},[prize,rotate_animate]);return/*#__PURE__*/ (// 中间奖品\n_jsx(\"ul\",{id:\"wheel\",className:\"wheel-list\",style:{transform:\"rotate(\".concat(rotate_animate.angle,\"deg)\"),transition:rotate_animate.transition},children:data.map(function(prize,index){return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"i\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"prize\",children:[/*#__PURE__*/_jsx(\"p\",{children:prize.prize_name}),/*#__PURE__*/_jsx(\"img\",{src:\"/images/prize_img\".concat(index+1,\".png\"),alt:\"\"})]})]},prize.prize_id);})}));}","map":{"version":3,"sources":["C:/Users/田天/Desktop/takeprize/src/component/Wheel-list/index.jsx"],"names":["React","useState","useEffect","axios","nanoid","PubSub","WheelList","data","setdata","prize","setprize","angle","transition","rotate_animate","setrotate","fetchData","result","prize_info","response","n","length","i","push","prize_name","isprize","prize_id","pop","token","subscribe","msg","item","prize_index","setTimeout","publish","unsubscribe","transform","map","index"],"mappings":"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","sourcesContent":["import React,{useState,useEffect} from 'react'\r\nimport axios from 'axios';\r\nimport './index.css'\r\nimport { nanoid } from 'nanoid';\r\nimport PubSub from 'pubsub-js';\r\n\r\nexport default function WheelList() {\r\n    //初始化为一个空数组很重要,没用的话被报undefined错误\r\n    const [data, setdata] = useState([]);\r\n    // {prize_index:0,msg:''}\r\n    const [prize,setprize] = useState();\r\n    const [rotate_animate,setrotate] = useState({angle:0,transition:'none'});\r\n    // 旧写法\r\n    // useEffect(() => {\r\n    //     axios.post('https://qc1hz1.fn.thelarkcloud.com/prizeinfo')\r\n    //     .then(function (res) {\r\n    //         let prize_info = res.data.response;\r\n    //         const n=prize_info.length;\r\n    //         if(n<6){\r\n    //             for(let i=n;i<6;i++){\r\n    //                 prize_info.push({prize_name: \"谢谢参与\", isprize: false,prize_id:nanoid()});\r\n    //             }   \r\n    //         }\r\n    //         if(n>6){\r\n    //             while(prize_info.length>6){\r\n    //                 prize_info.pop();\r\n    //             }\r\n    //         }\r\n    //         setdata(prize_info);\r\n    //     });\r\n    // }, [])\r\n\r\n    // 熟悉新写法!\r\n    useEffect(() => {\r\n        const fetchData=async ()=>{\r\n            const result = await axios('https://qc1hz1.fn.thelarkcloud.com/prizeinfo');\r\n            const prize_info = result.data.response;\r\n            const n=prize_info.length;\r\n            if(n<6){\r\n                for(let i=n;i<6;i++){\r\n                    prize_info.push({prize_name: \"谢谢参与\", isprize: false,prize_id:nanoid()});\r\n                }   \r\n            }\r\n            if(n>6){\r\n                while(prize_info.length>6){\r\n                    prize_info.pop();\r\n                }\r\n            }\r\n            setdata(prize_info);\r\n        }\r\n        fetchData();\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        const token = PubSub.subscribe('Prize',(msg,item)=>{\r\n            setprize(item);\r\n            const angle=-item.prize_index*60+3600;\r\n            setrotate({angle:angle,transition:'all 5s ease-out'});\r\n\r\n            setTimeout(() => {\r\n                //对角度进行处理，以便下次旋转\r\n                setrotate({angle:angle%360,transition:'none'});\r\n                //通知闪烁,同时把中奖消息发送过去\r\n                PubSub.publish('Twinkle',item.msg);\r\n            }, 5000);\r\n        })\r\n        return () => {\r\n            PubSub.unsubscribe(token);\r\n        }\r\n    }, [prize,rotate_animate])\r\n\r\n    return (\r\n        // 中间奖品\r\n        <ul id=\"wheel\" className=\"wheel-list\" style={{\r\n            transform:`rotate(${rotate_animate.angle}deg)`,\r\n            transition:rotate_animate.transition\r\n        }} >\r\n            {\r\n                data.map((prize,index)=>(\r\n                    <li key={prize.prize_id} >\r\n                        <i></i>\r\n                        <div className=\"prize\">\r\n                            <p>{prize.prize_name}</p>\r\n                            <img src={`/images/prize_img${index+1}.png`} alt=\"\" />\r\n                        </div>\r\n                    </li>\r\n                ))\r\n            }\r\n        </ul>\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}