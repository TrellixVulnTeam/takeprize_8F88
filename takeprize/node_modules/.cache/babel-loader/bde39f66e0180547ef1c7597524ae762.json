{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/\\u7530\\u5929/Desktop/\\u62BD\\u5956\\u8F6E\\u76D8/\\u6210\\u54C1\\u7B2C\\u4E8C\\u6B21\\u4FEE\\u6539/takeprize/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/\\u7530\\u5929/Desktop/\\u62BD\\u5956\\u8F6E\\u76D8/\\u6210\\u54C1\\u7B2C\\u4E8C\\u6B21\\u4FEE\\u6539/takeprize/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/\\u7530\\u5929/Desktop/\\u62BD\\u5956\\u8F6E\\u76D8/\\u6210\\u54C1\\u7B2C\\u4E8C\\u6B21\\u4FEE\\u6539/takeprize/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import axios from'axios';import'./index.css';import{nanoid}from'nanoid';import PubSub from'pubsub-js';//包含6个唯一id的数组，用来生成奖项\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var initdata=new Array(6).fill(0).map(function(){return nanoid();});export default function WheelList(){//奖品信息\nvar _useState=useState([]),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setdata=_useState2[1];//奖品index和中奖消息\nvar _useState3=useState(),_useState4=_slicedToArray(_useState3,2),prize=_useState4[0],setprize=_useState4[1];// 旋转动画\nvar _useState5=useState({angle:0,transition:'none'}),_useState6=_slicedToArray(_useState5,2),rotate_animate=_useState6[0],setrotate=_useState6[1];//从后台获取需要进行展示的奖品信息，并且保证为6个\nuseEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result,prize_info,n,i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios('https://qc1hz1.fn.thelarkcloud.com/prizeinfo');case 2:result=_context.sent;prize_info=result.data.response;// 计算奖品数量，保证其为6个\nn=prize_info.length;if(n<6){for(i=n;i<6;i++){prize_info.push({prize_name:\"谢谢参与\",isprize:false,prize_id:nanoid()});}}if(n>6){while(prize_info.length>6){prize_info.pop();}}setdata(prize_info);case 8:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();},[]);//订阅消息：收到消息后进行旋转\nuseEffect(function(){var token=PubSub.subscribe('Prize',function(msg,item){// 保存奖品index和中奖消息msg\nsetprize(item);// 计算要旋转的角度并旋转\nvar angle=-item.prize_index*60+3600;setrotate({angle:angle,transition:'all 5s ease-out'});//旋转完成后\nsetTimeout(function(){//对角度进行处理，以便下次旋转\nsetrotate({angle:angle%360,transition:'none'});//通知闪烁,同时把中奖消息发送过去\nPubSub.publish('Twinkle',item.msg);},5000);});return function(){PubSub.unsubscribe(token);};},[prize,rotate_animate]);return/*#__PURE__*/ (//中间奖品\n_jsx(\"ul\",{id:\"wheel\",className:\"wheel-list\",style:{transform:\"rotate(\".concat(rotate_animate.angle,\"deg)\"),transition:rotate_animate.transition},children:initdata.map(function(item,index){return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"i\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"prize\",children:[/*#__PURE__*/_jsx(\"p\",{children:data[index]?data[index].prize_name:\"\"}),/*#__PURE__*/_jsx(\"img\",{src:\"/images/prize_img\".concat(index+1,\".png\"),alt:\"\"})]})]},item);})}));}","map":{"version":3,"sources":["C:/Users/田天/Desktop/抽奖轮盘/成品第二次修改/takeprize/src/component/Wheel-list/index.jsx"],"names":["React","useState","useEffect","axios","nanoid","PubSub","initdata","Array","fill","map","WheelList","data","setdata","prize","setprize","angle","transition","rotate_animate","setrotate","fetchData","result","prize_info","response","n","length","i","push","prize_name","isprize","prize_id","pop","token","subscribe","msg","item","prize_index","setTimeout","publish","unsubscribe","transform","index"],"mappings":"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","sourcesContent":["import React,{useState,useEffect} from 'react'\r\nimport axios from 'axios';\r\nimport './index.css'\r\nimport { nanoid } from 'nanoid';\r\nimport PubSub from 'pubsub-js';\r\n\r\n//包含6个唯一id的数组，用来生成奖项\r\nconst initdata = new Array(6).fill(0).map(()=>nanoid());\r\nexport default function WheelList() {\r\n    //奖品信息\r\n    const [data, setdata] = useState([]);\r\n    //奖品index和中奖消息\r\n    const [prize,setprize] = useState();\r\n    // 旋转动画\r\n    const [rotate_animate,setrotate] = useState({angle:0,transition:'none'});\r\n    //从后台获取需要进行展示的奖品信息，并且保证为6个\r\n    \r\n    useEffect(() => {\r\n        const fetchData=async ()=>{\r\n            // 获取奖品信息\r\n            const result = await axios('https://qc1hz1.fn.thelarkcloud.com/prizeinfo');\r\n            const prize_info = result.data.response;\r\n            // 计算奖品数量，保证其为6个\r\n            const n=prize_info.length;\r\n            if(n<6){\r\n                for(let i=n;i<6;i++){\r\n                    prize_info.push({prize_name: \"谢谢参与\", isprize: false,prize_id:nanoid()});\r\n                }   \r\n            }\r\n            if(n>6){\r\n                while(prize_info.length>6){\r\n                    prize_info.pop();\r\n                }\r\n            }\r\n            setdata(prize_info);\r\n        }\r\n        fetchData();\r\n    }, [])\r\n    \r\n    //订阅消息：收到消息后进行旋转\r\n    useEffect(() => {\r\n        const token = PubSub.subscribe('Prize',(msg,item)=>{\r\n            // 保存奖品index和中奖消息msg\r\n            setprize(item);\r\n            // 计算要旋转的角度并旋转\r\n            const angle=-item.prize_index*60+3600;\r\n            setrotate({angle:angle,transition:'all 5s ease-out'});\r\n            //旋转完成后\r\n            setTimeout(() => {\r\n                //对角度进行处理，以便下次旋转\r\n                setrotate({angle:angle%360,transition:'none'});\r\n                //通知闪烁,同时把中奖消息发送过去\r\n                PubSub.publish('Twinkle',item.msg);\r\n            }, 5000);\r\n        })\r\n        return () => {\r\n            PubSub.unsubscribe(token);\r\n        }\r\n    }, [prize,rotate_animate])\r\n\r\n    return (\r\n        //中间奖品\r\n        <ul id=\"wheel\" className=\"wheel-list\" style={{\r\n            transform:`rotate(${rotate_animate.angle}deg)`,\r\n            transition:rotate_animate.transition\r\n        }} >\r\n            {\r\n                initdata.map((item,index)=>(\r\n                    <li key={item} >\r\n                        <i></i>\r\n                        <div className=\"prize\">\r\n                            <p>{data[index]?data[index].prize_name:\"\"}</p>\r\n                            <img src={`/images/prize_img${index+1}.png`} alt=\"\" />\r\n                        </div>\r\n                    </li>\r\n                ))\r\n            }\r\n        </ul>\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}